<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>红色黎明 - 中国战略模拟</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#C41E3A', // 共产党红色
                        secondary: '#1E3A8A',
                        dark: '#111827',
                        light: '#F9FAFB',
                        map: {
                            province: '#4B5563',
                            owned: '#10B981',
                            enemy: '#EF4444',
                            neutral: '#9CA3AF',
                            selected: '#F59E0B'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .map-grid {
                display: grid;
                grid-template-columns: repeat(16, minmax(0, 1fr));
                grid-template-rows: repeat(12, minmax(0, 1fr));
                gap: 1px;
            }
            .province {
                transition: all 0.2s ease;
                cursor: pointer;
            }
            .province:hover {
                filter: brightness(1.2);
                transform: scale(1.05);
            }
            .tech-node {
                transition: all 0.2s ease;
            }
            .tech-node:hover {
                transform: translateY(-2px);
            }
            .btn-action {
                @apply bg-primary hover:bg-primary/80 text-white font-bold py-2 px-4 rounded transition-all duration-200 transform hover:scale-105 active:scale-95;
            }
            .panel {
                @apply bg-dark/80 backdrop-blur-sm rounded-lg border border-gray-700 shadow-lg p-4;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-light min-h-screen flex flex-col overflow-hidden">
    <!-- 顶部状态栏 -->
    <header class="bg-dark border-b border-gray-700 px-4 py-2 flex justify-between items-center">
        <div class="flex items-center space-x-4">
            <h1 class="text-2xl font-bold text-primary flex items-center">
                <i class="fa fa-star mr-2"></i>红色黎明
            </h1>
            <div class="hidden md:flex items-center space-x-6">
                <div class="flex items-center">
                    <i class="fa fa-calendar-o mr-1"></i>
                    <span id="game-date">1936年1月1日</span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-industry mr-1"></i>
                    <span id="resource-industry">工业: 12</span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-wheat mr-1"></i>
                    <span id="resource-food">粮食: 45</span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-users mr-1"></i>
                    <span id="resource-manpower">人力: 1250000</span>
                </div>
                <div class="flex items-center">
                    <i class="fa fa-money mr-1"></i>
                    <span id="resource-money">资金: 3200</span>
                </div>
            </div>
        </div>
        <div class="flex items-center space-x-3">
            <button id="btn-save" class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded text-sm">
                <i class="fa fa-save mr-1"></i>保存
            </button>
            <button id="btn-menu" class="bg-gray-700 hover:bg-gray-600 text-white py-1 px-3 rounded text-sm">
                <i class="fa fa-bars mr-1"></i>菜单
            </button>
            <button id="btn-speed" class="bg-gray-700 hover:bg-gray-600 text-white py-1 px-3 rounded text-sm">
                <i class="fa fa-play mr-1"></i>1x
            </button>
        </div>
    </header>

    <!-- 主游戏区域 -->
    <main class="flex flex-1 overflow-hidden">
        <!-- 左侧面板 -->
        <aside class="w-64 bg-dark border-r border-gray-700 flex flex-col overflow-hidden">
            <!-- 省份信息 -->
            <div class="panel flex-1 overflow-y-auto">
                <h2 class="text-lg font-bold mb-3 flex items-center">
                    <i class="fa fa-map-marker text-primary mr-2"></i>省份信息
                </h2>
                <div id="province-info" class="space-y-2">
                    <p class="text-gray-400 italic text-sm">请在地图上选择一个省份</p>
                </div>
            </div>
            
            <!-- 军事单位 -->
            <div class="panel border-t border-gray-700 flex-1 overflow-y-auto">
                <h2 class="text-lg font-bold mb-3 flex items-center">
                    <i class="fa fa-shield text-primary mr-2"></i>军事单位
                </h2>
                <div id="military-units" class="space-y-2 max-h-full overflow-y-auto">
                    <div class="bg-gray-800 rounded p-2 hover:bg-gray-700 transition-colors">
                        <div class="font-bold">第1集团军</div>
                        <div class="text-sm text-gray-400">位置: 陕西省</div>
                        <div class="text-sm">兵力: 24,000 <i class="fa fa-soldier"></i></div>
                        <div class="text-sm">将领: 彭德怀</div>
                    </div>
                    <div class="bg-gray-800 rounded p-2 hover:bg-gray-700 transition-colors">
                        <div class="font-bold">第2集团军</div>
                        <div class="text-sm text-gray-400">位置: 甘肃省</div>
                        <div class="text-sm">兵力: 18,000 <i class="fa fa-soldier"></i></div>
                        <div class="text-sm">将领: 贺龙</div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- 中央地图区域 -->
        <section class="flex-1 overflow-hidden relative bg-gray-800">
            <!-- 地图控制 -->
            <div class="absolute top-4 left-4 z-10 bg-dark/70 backdrop-blur-sm rounded-lg p-2 flex flex-col space-y-2">
                <button id="zoom-in" class="w-8 h-8 flex items-center justify-center rounded hover:bg-gray-700">
                    <i class="fa fa-search-plus"></i>
                </button>
                <button id="zoom-out" class="w-8 h-8 flex items-center justify-center rounded hover:bg-gray-700">
                    <i class="fa fa-search-minus"></i>
                </button>
                <div class="border-t border-gray-700 my-1"></div>
                <button id="map-china" class="w-8 h-8 flex items-center justify-center rounded hover:bg-gray-700 bg-primary/20">
                    <i class="fa fa-map"></i>
                </button>
                <button id="map-asia" class="w-8 h-8 flex items-center justify-center rounded hover:bg-gray-700">
                    <i class="fa fa-globe"></i>
                </button>
            </div>

            <!-- 地图容器 -->
            <div id="map-container" class="w-full h-full overflow-hidden relative">
                <div id="map" class="absolute w-[2000px] h-[1500px] top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 transition-transform duration-300 ease-out">
                    <!-- 中国地图将通过JS动态生成 -->
                    <div id="china-map" class="map-grid w-full h-full">
                        <!-- 省份将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 快速操作按钮 -->
            <div class="absolute bottom-4 right-4 z-10 flex flex-col space-y-2">
                <button id="btn-tech" class="btn-action flex items-center">
                    <i class="fa fa-flask mr-2"></i>科技
                </button>
                <button id="btn-recruit" class="btn-action flex items-center">
                    <i class="fa fa-user-plus mr-2"></i>招募
                </button>
                <button id="btn-events" class="btn-action flex items-center">
                    <i class="fa fa-flag mr-2"></i>事件
                </button>
            </div>
        </section>

        <!-- 右侧面板 -->
        <aside class="w-80 bg-dark border-l border-gray-700 flex flex-col overflow-hidden">
            <!-- 事件面板 -->
            <div class="panel flex-1 overflow-y-auto">
                <h2 class="text-lg font-bold mb-3 flex items-center">
                    <i class="fa fa-newspaper-o text-primary mr-2"></i>历史事件
                </h2>
                <div id="events-container" class="space-y-3">
                    <div class="bg-primary/10 border-l-4 border-primary rounded p-3">
                        <div class="font-bold">西安事变</div>
                        <div class="text-sm text-gray-400 mb-2">1936年12月12日</div>
                        <p class="text-sm mb-2">张学良和杨虎城发动兵谏，扣押蒋介石，要求停止内战、一致抗日。</p>
                        <div class="flex space-x-2 mt-2">
                            <button class="bg-primary/80 hover:bg-primary text-xs px-2 py-1 rounded">支持联合抗日</button>
                            <button class="bg-gray-700 hover:bg-gray-600 text-xs px-2 py-1 rounded">保持独立</button>
                        </div>
                    </div>
                    <div class="bg-gray-800 rounded p-3">
                        <div class="font-bold">日军全面侵华</div>
                        <div class="text-sm text-gray-400 mb-2">1937年7月7日（即将发生）</div>
                        <p class="text-sm">预计日军将在卢沟桥发动进攻，全面侵华战争即将爆发。</p>
                    </div>
                </div>
            </div>
            
            <!-- 将领系统 -->
            <div class="panel border-t border-gray-700 flex-1 overflow-y-auto">
                <h2 class="text-lg font-bold mb-3 flex items-center">
                    <i class="fa fa-user-circle text-primary mr-2"></i>将领系统
                </h2>
                <div id="generals-container" class="space-y-3">
                    <div class="flex items-center space-x-3 bg-gray-800 rounded p-2 hover:bg-gray-700 transition-colors">
                        <img src="https://picsum.photos/id/1005/60/60" alt="毛泽东" class="w-12 h-12 rounded-full object-cover">
                        <div>
                            <div class="font-bold">毛泽东</div>
                            <div class="text-xs text-gray-400">领袖 | 政治: 95 战略: 90</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 bg-gray-800 rounded p-2 hover:bg-gray-700 transition-colors">
                        <img src="https://picsum.photos/id/1012/60/60" alt="朱德" class="w-12 h-12 rounded-full object-cover">
                        <div>
                            <div class="font-bold">朱德</div>
                            <div class="text-xs text-gray-400">元帅 | 指挥: 85 进攻: 80</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 bg-gray-800 rounded p-2 hover:bg-gray-700 transition-colors">
                        <img src="https://picsum.photos/id/1025/60/60" alt="彭德怀" class="w-12 h-12 rounded-full object-cover">
                        <div>
                            <div class="font-bold">彭德怀</div>
                            <div class="text-xs text-gray-400">元帅 | 指挥: 90 防御: 85</div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </main>

    <!-- 科技树模态框 -->
    <div id="tech-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center hidden">
        <div class="bg-dark border border-gray-700 rounded-lg w-4/5 max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <h2 class="text-xl font-bold flex items-center">
                    <i class="fa fa-flask text-primary mr-2"></i>科技树
                </h2>
                <button id="close-tech" class="text-gray-400 hover:text-white">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-4 overflow-y-auto flex-1">
                <div class="mb-6">
                    <h3 class="text-lg font-bold mb-3 text-primary">军事科技</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="tech-node bg-gray-800 rounded p-3 border border-gray-700">
                            <div class="font-bold">步兵武器 I</div>
                            <div class="text-sm text-gray-400 mb-2">研究时间: 60天</div>
                            <p class="text-xs">提升步兵攻击力10%</p>
                            <button class="mt-2 w-full bg-primary/80 hover:bg-primary text-xs py-1 rounded">开始研究</button>
                        </div>
                        <div class="tech-node bg-gray-800 rounded p-3 border border-gray-700">
                            <div class="font-bold">轻型坦克 I</div>
                            <div class="text-sm text-gray-400 mb-2">研究时间: 120天</div>
                            <p class="text-xs">解锁轻型坦克部队</p>
                            <button class="mt-2 w-full bg-gray-700 text-gray-400 text-xs py-1 rounded cursor-not-allowed">需要前置科技</button>
                        </div>
                        <div class="tech-node bg-gray-800 rounded p-3 border border-gray-700">
                            <div class="font-bold">基本战术</div>
                            <div class="text-sm text-gray-400 mb-2">研究时间: 90天</div>
                            <p class="text-xs">提升所有部队组织度</p>
                            <button class="mt-2 w-full bg-primary/80 hover:bg-primary text-xs py-1 rounded">开始研究</button>
                        </div>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-bold mb-3 text-primary">工业科技</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="tech-node bg-gray-800 rounded p-3 border border-gray-700">
                            <div class="font-bold">基础工业</div>
                            <div class="text-sm text-gray-400 mb-2">研究时间: 150天</div>
                            <p class="text-xs">提升工业产能20%</p>
                            <button class="mt-2 w-full bg-primary/80 hover:bg-primary text-xs py-1 rounded">开始研究</button>
                        </div>
                        <div class="tech-node bg-gray-800 rounded p-3 border border-gray-700">
                            <div class="font-bold">铁路建设</div>
                            <div class="text-sm text-gray-400 mb-2">研究时间: 120天</div>
                            <p class="text-xs">提升部队移动速度</p>
                            <button class="mt-2 w-full bg-primary/80 hover:bg-primary text-xs py-1 rounded">开始研究</button>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-bold mb-3 text-primary">政治科技</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="tech-node bg-gray-800 rounded p-3 border border-gray-700">
                            <div class="font-bold">宣传工作</div>
                            <div class="text-sm text-gray-400 mb-2">研究时间: 90天</div>
                            <p class="text-xs">提升民众支持度和征兵效率</p>
                            <button class="mt-2 w-full bg-primary/80 hover:bg-primary text-xs py-1 rounded">开始研究</button>
                        </div>
                        <div class="tech-node bg-gray-800 rounded p-3 border border-gray-700">
                            <div class="font-bold">外交技巧</div>
                            <div class="text-sm text-gray-400 mb-2">研究时间: 180天</div>
                            <p class="text-xs">改善与其他势力的关系</p>
                            <button class="mt-2 w-full bg-primary/80 hover:bg-primary text-xs py-1 rounded">开始研究</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 开局选择模态框 -->
    <div id="start-modal" class="fixed inset-0 bg-black/90 z-50 flex items-center justify-center">
        <div class="bg-dark border border-gray-700 rounded-lg w-3/4 max-w-2xl p-6">
            <h2 class="text-2xl font-bold mb-4 text-primary text-center">红色黎明 - 中国战略模拟</h2>
            <p class="text-center mb-6">选择你的初始省份，领导共产党走向胜利</p>
            
            <div class="mb-6">
                <h3 class="text-lg font-bold mb-3">选择起始省份</h3>
                <div class="grid grid-cols-3 gap-2">
                    <button class="start-province bg-gray-800 hover:bg-primary/80 p-3 rounded text-center transition-colors" data-province="shaanxi">
                        <div>陕西省</div>
                        <div class="text-xs text-gray-400">延安根据地</div>
                    </button>
                    <button class="start-province bg-gray-800 hover:bg-primary/80 p-3 rounded text-center transition-colors" data-province="gansu">
                        <div>甘肃省</div>
                        <div class="text-xs text-gray-400">稳固后方</div>
                    </button>
                    <button class="start-province bg-gray-800 hover:bg-primary/80 p-3 rounded text-center transition-colors" data-province="shandong">
                        <div>山东省</div>
                        <div class="text-xs text-gray-400">敌后战场</div>
                    </button>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-lg font-bold mb-3">游戏难度</h3>
                <div class="flex space-x-3">
                    <button class="difficulty-btn bg-gray-800 hover:bg-primary/80 px-4 py-2 rounded flex-1 transition-colors" data-difficulty="easy">
                        简单
                    </button>
                    <button class="difficulty-btn bg-gray-800 hover:bg-primary/80 px-4 py-2 rounded flex-1 transition-colors" data-difficulty="normal">
                        普通
                    </button>
                    <button class="difficulty-btn bg-gray-800 hover:bg-primary/80 px-4 py-2 rounded flex-1 transition-colors" data-difficulty="hard">
                        困难
                    </button>
                </div>
            </div>
            
            <button id="start-game" class="btn-action w-full">
                开始游戏
            </button>
        </div>
    </div>

    <script>
        // 中国省份数据
        const provinces = [
            { id: 'hebei', name: '河北省', x: 7, y: 3, resources: { industry: 15, food: 60, manpower: 1800000 } },
            { id: 'shanxi', name: '山西省', x: 6, y: 4, resources: { industry: 10, food: 40, manpower: 1200000 } },
            { id: 'shaanxi', name: '陕西省', x: 5, y: 5, resources: { industry: 8, food: 35, manpower: 1000000 } },
            { id: 'gansu', name: '甘肃省', x: 4, y: 6, resources: { industry: 5, food: 25, manpower: 800000 } },
            { id: 'qinghai', name: '青海省', x: 4, y: 7, resources: { industry: 3, food: 15, manpower: 500000 } },
            { id: 'xinjiang', name: '新疆维吾尔自治区', x: 2, y: 7, resources: { industry: 4, food: 20, manpower: 700000 } },
            { id: 'neimenggu', name: '内蒙古自治区', x: 7, y: 5, resources: { industry: 6, food: 30, manpower: 600000 } },
            { id: 'liaoning', name: '辽宁省', x: 9, y: 3, resources: { industry: 20, food: 45, manpower: 1500000 } },
            { id: 'jilin', name: '吉林省', x: 10, y: 3, resources: { industry: 12, food: 50, manpower: 1100000 } },
            { id: 'heilongjiang', name: '黑龙江省', x: 11, y: 3, resources: { industry: 10, food: 55, manpower: 900000 } },
            { id: 'shandong', name: '山东省', x: 8, y: 4, resources: { industry: 18, food: 70, manpower: 2000000 } },
            { id: 'jiangsu', name: '江苏省', x: 8, y: 5, resources: { industry: 25, food: 65, manpower: 2200000 } },
            { id: 'zhejiang', name: '浙江省', x: 9, y: 6, resources: { industry: 20, food: 50, manpower: 1600000 } },
            { id: 'anhui', name: '安徽省', x: 7, y: 5, resources: { industry: 12, food: 60, manpower: 1500000 } },
            { id: 'fujian', name: '福建省', x: 10, y: 7, resources: { industry: 10, food: 40, manpower: 1100000 } },
            { id: 'jiangxi', name: '江西省', x: 8, y: 6, resources: { industry: 8, food: 55, manpower: 1300000 } },
            { id: 'hubei', name: '湖北省', x: 7, y: 6, resources: { industry: 15, food: 60, manpower: 1700000 } },
            { id: 'hunan', name: '湖南省', x: 7, y: 7, resources: { industry: 12, food: 65, manpower: 1600000 } },
            { id: 'guangdong', name: '广东省', x: 9, y: 8, resources: { industry: 22, food: 50, manpower: 2100000 } },
            { id: 'guangxi', name: '广西壮族自治区', x: 8, y: 8, resources: { industry: 8, food: 45, manpower: 1200000 } },
            { id: 'hainan', name: '海南省', x: 10, y: 9, resources: { industry: 5, food: 30, manpower: 600000 } },
            { id: 'sichuan', name: '四川省', x: 5, y: 8, resources: { industry: 18, food: 70, manpower: 2500000 } },
            { id: 'guizhou', name: '贵州省', x: 6, y: 8, resources: { industry: 6, food: 40, manpower: 1000000 } },
            { id: 'yunnan', name: '云南省', x: 6, y: 9, resources: { industry: 7, food: 45, manpower: 1100000 } },
            { id: 'xizang', name: '西藏自治区', x: 3, y: 9, resources: { industry: 2, food: 10, manpower: 300000 } },
            { id: 'beijing', name: '北京市', x: 7, y: 3, resources: { industry: 30, food: 20, manpower: 800000 } },
            { id: 'shanghai', name: '上海市', x: 8, y: 5, resources: { industry: 40, food: 10, manpower: 1000000 } },
            { id: 'tianjin', name: '天津市', x: 7, y: 3, resources: { industry: 25, food: 15, manpower: 700000 } },
            { id: 'chongqing', name: '重庆市', x: 5, y: 8, resources: { industry: 20, food: 30, manpower: 1200000 } }
        ];

        // 游戏状态
        const gameState = {
            date: new Date(1936, 0, 1),
            speed: 1, // 1x, 2x, 3x, 4x
            running: false,
            selectedProvince: null,
            ownedProvinces: [],
            resources: {
                industry: 12,
                food: 45,
                manpower: 1250000,
                money: 3200
            },
            difficulty: 'normal',
            currentMap: 'china', // china or asia
            zoom: 1,
            events: [],
            generals: [],
            militaryUnits: []
        };

        // DOM 元素
        const elements = {
            mapContainer: document.getElementById('map-container'),
            map: document.getElementById('map'),
            chinaMap: document.getElementById('china-map'),
            provinceInfo: document.getElementById('province-info'),
            gameDate: document.getElementById('game-date'),
            resourceIndustry: document.getElementById('resource-industry'),
            resourceFood: document.getElementById('resource-food'),
            resourceManpower: document.getElementById('resource-manpower'),
            resourceMoney: document.getElementById('resource-money'),
            btnSpeed: document.getElementById('btn-speed'),
            btnTech: document.getElementById('btn-tech'),
            techModal: document.getElementById('tech-modal'),
            closeTech: document.getElementById('close-tech'),
            startModal: document.getElementById('start-modal'),
            startGame: document.getElementById('start-game'),
            startProvinces: document.querySelectorAll('.start-province'),
            difficultyBtns: document.querySelectorAll('.difficulty-btn'),
            zoomIn: document.getElementById('zoom-in'),
            zoomOut: document.getElementById('zoom-out'),
            mapChina: document.getElementById('map-china'),
            mapAsia: document.getElementById('map-asia')
        };

        // 初始化省份
        function initializeProvinces() {
            provinces.forEach(province => {
                const provinceElement = document.createElement('div');
                provinceElement.id = `province-${province.id}`;
                provinceElement.className = `province bg-map-neutral col-start-${province.x} row-start-${province.y} col-span-1 row-span-1 relative`;
                provinceElement.title = province.name;
                provinceElement.dataset.id = province.id;
                
                // 添加省份名称标签
                const nameLabel = document.createElement('div');
                nameLabel.className = 'absolute bottom-0 left-0 right-0 bg-black/50 text-xs p-0.5 text-center truncate';
                nameLabel.textContent = province.name;
                provinceElement.appendChild(nameLabel);
                
                // 添加点击事件
                provinceElement.addEventListener('click', () => selectProvince(province.id));
                
                elements.chinaMap.appendChild(provinceElement);
            });
        }

        // 选择省份
        function selectProvince(provinceId) {
            // 取消之前的选择
            if (gameState.selectedProvince) {
                const prevProvince = document.getElementById(`province-${gameState.selectedProvince}`);
                if (prevProvince) {
                    if (gameState.ownedProvinces.includes(gameState.selectedProvince)) {
                        prevProvince.classList.remove('bg-map-selected');
                        prevProvince.classList.add('bg-map-owned');
                    } else {
                        prevProvince.classList.remove('bg-map-selected');
                        prevProvince.classList.add('bg-map-neutral');
                    }
                }
            }
            
            // 设置新选择
            gameState.selectedProvince = provinceId;
            const province = document.getElementById(`province-${provinceId}`);
            if (province) {
                province.classList.remove('bg-map-owned', 'bg-map-neutral', 'bg-map-enemy');
                province.classList.add('bg-map-selected');
            }
            
            // 更新省份信息面板
            updateProvinceInfo(provinceId);
        }

        // 更新省份信息面板
        function updateProvinceInfo(provinceId) {
            const province = provinces.find(p => p.id === provinceId);
            if (!province) return;
            
            const isOwned = gameState.ownedProvinces.includes(provinceId);
            
            elements.provinceInfo.innerHTML = `
                <div class="font-bold text-lg">${province.name}</div>
                <div class="text-sm text-gray-400 mb-2">
                    ${isOwned ? '<span class="text-green-500"><i class="fa fa-check-circle"></i> 我方控制</span>' : 
                      '<span class="text-yellow-500"><i class="fa fa-minus-circle"></i> 中立</span>'}
                </div>
                <div class="space-y-1 text-sm">
                    <div class="flex justify-between">
                        <span><i class="fa fa-industry text-gray-400 mr-1"></i> 工业</span>
                        <span>${province.resources.industry}</span>
                    </div>
                    <div class="flex justify-between">
                        <span><i class="fa fa-wheat text-gray-400 mr-1"></i> 粮食</span>
                        <span>${province.resources.food}</span>
                    </div>
                    <div class="flex justify-between">
                        <span><i class="fa fa-users text-gray-400 mr-1"></i> 人口</span>
                        <span>${province.resources.manpower.toLocaleString()}</span>
                    </div>
                </div>
                ${isOwned ? `
                    <div class="mt-3 space-y-2">
                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white text-xs py-1 rounded">
                            <i class="fa fa-wrench mr-1"></i> 建设
                        </button>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white text-xs py-1 rounded">
                            <i class="fa fa-user-plus mr-1"></i> 征兵
                        </button>
                    </div>
                ` : `
                    <div class="mt-3">
                        <button class="w-full bg-gray-600 hover:bg-gray-500 text-white text-xs py-1 rounded" ${!canConquerProvince(provinceId) ? 'disabled' : ''}>
                            <i class="fa fa-flag mr-1"></i> 占领
                        </button>
                    </div>
                `}
            `;
        }

        // 检查是否可以占领省份
        function canConquerProvince(provinceId) {
            // 简单逻辑：检查是否有相邻的已拥有省份
            const province = provinces.find(p => p.id === provinceId);
            if (!province) return false;
            
            return gameState.ownedProvinces.some(ownedId => {
                const ownedProvince = provinces.find(p => p.id === ownedId);
                if (!ownedProvince) return false;
                
                // 检查是否相邻（简单的坐标检查）
                const dx = Math.abs(ownedProvince.x - province.x);
                const dy = Math.abs(ownedProvince.y - province.y);
                return dx <= 1 && dy <= 1 && !(dx === 0 && dy === 0);
            });
        }

        // 更新游戏日期显示
        function updateDateDisplay() {
            const year = gameState.date.getFullYear();
            const month = gameState.date.getMonth() + 1;
            const day = gameState.date.getDate();
            elements.gameDate.textContent = `${year}年${month}月${day}日`;
        }

        // 更新资源显示
        function updateResourcesDisplay() {
            elements.resourceIndustry.textContent = `工业: ${gameState.resources.industry}`;
            elements.resourceFood.textContent = `粮食: ${gameState.resources.food}`;
            elements.resourceManpower.textContent = `人力: ${gameState.resources.manpower.toLocaleString()}`;
            elements.resourceMoney.textContent = `资金: ${gameState.resources.money}`;
        }

        // 推进游戏时间
        function advanceTime() {
            if (!gameState.running) return;
            
            // 根据速度推进不同的天数
            const daysToAdd = gameState.speed;
            gameState.date.setDate(gameState.date.getDate() + daysToAdd);
            
            // 每天更新
            updateDateDisplay();
            
            // 每月更新资源
            if (gameState.date.getDate() === 1) {
                updateMonthlyResources();
                checkMonthlyEvents();
            }
            
            // 继续计时
            setTimeout(advanceTime, 1000 / gameState.speed);
        }

        // 更新月度资源
        function updateMonthlyResources() {
            // 计算所有拥有省份的资源总和
            let industryGain = 0;
            let foodGain = 0;
            let manpowerGain = 0;
            
            gameState.ownedProvinces.forEach(provinceId => {
                const province = provinces.find(p => p.id === provinceId);
                if (province) {
                    industryGain += province.resources.industry;
                    foodGain += province.resources.food;
                    manpowerGain += Math.floor(province.resources.manpower * 0.01); // 1%的人口增长
                }
            });
            
            // 根据难度调整
            if (gameState.difficulty === 'hard') {
                industryGain *= 0.8;
                foodGain *= 0.8;
            } else if (gameState.difficulty === 'easy') {
                industryGain *= 1.2;
                foodGain *= 1.2;
                manpowerGain *= 1.2;
            }
            
            // 更新资源
            gameState.resources.industry += Math.floor(industryGain);
            gameState.resources.food += Math.floor(foodGain);
            gameState.resources.manpower += Math.floor(manpowerGain);
            
            // 资金根据工业产出计算
            gameState.resources.money += Math.floor(industryGain * 50);
            
            // 确保资源不为负
            if (gameState.resources.food < 0) gameState.resources.food = 0;
            
            // 更新显示
            updateResourcesDisplay();
        }

        // 检查月度事件
        function checkMonthlyEvents() {
            // 这里可以添加事件触发逻辑
            console.log('Checking for monthly events...');
        }

        // 切换游戏速度
        function toggleSpeed() {
            const speeds = [1, 2, 3, 4, 0]; // 0 表示暂停
            const speedLabels = ['1x', '2x', '3x', '4x', '暂停'];
            const speedIcons = ['fa-play', 'fa-forward', 'fa-forward', 'fa-forward', 'fa-pause'];
            
            // 找到当前速度的索引
            let currentIndex = speeds.indexOf(gameState.speed);
            currentIndex = (currentIndex + 1) % speeds.length;
            
            // 更新速度
            gameState.speed = speeds[currentIndex];
            gameState.running = gameState.speed > 0;
            
            // 更新按钮显示
            elements.btnSpeed.innerHTML = `<i class="fa ${speedIcons[currentIndex]} mr-1"></i>${speedLabels[currentIndex]}`;
            
            // 如果开始运行，启动时间推进
            if (gameState.running) {
                advanceTime();
            }
        }

        // 缩放地图
        function zoomMap(amount) {
            gameState.zoom = Math.max(0.5, Math.min(2, gameState.zoom + amount));
            elements.map.style.transform = `translate(-50%, -50%) scale(${gameState.zoom})`;
        }

        // 切换地图
        function switchMap(mapType) {
            gameState.currentMap = mapType;
            
            if (mapType === 'china') {
                elements.mapChina.style.display = 'grid';
                elements.mapAsia.style.display = 'none';
                elements.mapChina.classList.add('map-grid');
                elements.mapAsia.classList.remove('map-grid');
                elements.mapChina.classList.remove('hidden');
                elements.mapAsia.classList.add('hidden');
                
                elements.mapChina.classList.add('opacity-100');
                elements.mapAsia.classList.add('opacity-0');
                
                elements.mapChina.style.pointerEvents = 'auto';
                elements.mapAsia.style.pointerEvents = 'none';
                
                elements.mapChina.classList.remove('hidden');
                elements.mapAsia.classList.add('hidden');
                
                elements.mapChina.classList.add('block');
                elements.mapAsia.classList.remove('block');
                
                elements.mapChina.classList.add('opacity-100');
                elements.mapAsia.classList.add('opacity-0');
                
                elements.mapChina.style.pointerEvents = 'auto';
                elements.mapAsia.style.pointerEvents = 'none';
                
                elements.mapChina.classList.remove('hidden');
                elements.mapAsia.classList.add('hidden');
                
                elements.mapChina.classList.add('block');
                elements.mapAsia.classList.remove('block');
                
                elements.mapChina.classList.add('opacity-100');
                elements.mapAsia.classList.add('opacity-0');
                
                elements.mapChina.style.pointerEvents = 'auto';
                elements.mapAsia.style.pointerEvents = 'none';
                
                elements.mapChina.classList.remove('hidden');
                elements.mapAsia.classList.add('hidden');
                
                elements.mapChina.classList.add('block');
                elements.mapAsia.classList.remove('block');
                
                elements.mapChina.classList.add('opacity-100');
                elements.mapAsia.classList.add('opacity-0');
                
                elements.mapChina.style.pointerEvents = 'auto';
                elements.mapAsia.style.pointerEvents = 'none';
            } else {
                // 亚洲地图逻辑
                elements.mapChina.style.display = 'none';
                elements.mapAsia.style.display = 'grid';
                elements.mapAsia.classList.add('map-grid');
                elements.mapChina.classList.remove('map-grid');
                
                elements.mapChina.classList.add('opacity-0');
                elements.mapAsia.classList.add('opacity-100');
                
                elements.mapChina.style.pointerEvents = 'none';
                elements.mapAsia.style.pointerEvents = 'auto';
            }
            
            // 更新按钮状态
            elements.mapChina.classList.toggle('bg-primary/20', mapType === 'china');
            elements.mapAsia.classList.toggle('bg-primary/20', mapType === 'asia');
        }

        // 开始游戏
        function startGame() {
            // 隐藏开始模态框
            elements.startModal.classList.add('hidden');
            
            // 启动游戏时间
            gameState.running = true;
            advanceTime();
        }

        // 初始化事件监听
        function initializeEventListeners() {
            // 速度按钮
            elements.btnSpeed.addEventListener('click', toggleSpeed);
            
            // 科技按钮
            elements.btnTech.addEventListener('click', () => {
                elements.techModal.classList.remove('hidden');
            });
            
            // 关闭科技模态框
            elements.closeTech.addEventListener('click', () => {
                elements.techModal.classList.add('hidden');
            });
            
            // 开始游戏按钮
            elements.startGame.addEventListener('click', startGame);
            
            // 选择起始省份
            elements.startProvinces.forEach(btn => {
                btn.addEventListener('click', () => {
                    // 移除其他按钮的选中状态
                    elements.startProvinces.forEach(b => b.classList.remove('bg-primary/80'));
                    // 添加当前按钮的选中状态
                    btn.classList.add('bg-primary/80');
                    
                    // 设置初始省份
                    const provinceId = btn.dataset.province;
                    gameState.ownedProvinces = [provinceId];
                    
                    // 更新地图显示
                    const provinceElement = document.getElementById(`province-${provinceId}`);
                    if (provinceElement) {
                        provinceElement.classList.remove('bg-map-neutral');
                        provinceElement.classList.add('bg-map-owned');
                    }
                    
                    // 选中该省份
                    selectProvince(provinceId);
                });
            });
            
            // 选择难度
            elements.difficultyBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // 移除其他按钮的选中状态
                    elements.difficultyBtns.forEach(b => b.classList.remove('bg-primary/80'));
                    // 添加当前按钮的选中状态
                    btn.classList.add('bg-primary/80');
                    
                    // 设置难度
                    gameState.difficulty = btn.dataset.difficulty;
                });
            });
            
            // 地图缩放
            elements.zoomIn.addEventListener('click', () => zoomMap(0.2));
            elements.zoomOut.addEventListener('click', () => zoomMap(-0.2));
            
            // 切换地图
            elements.mapChina.addEventListener('click', () => switchMap('china'));
            elements.mapAsia.addEventListener('click', () => switchMap('asia'));
            
            // 默认选中第一个起始省份和普通难度
            if (elements.startProvinces.length > 0) {
                elements.startProvinces[0].click();
            }
            if (elements.difficultyBtns.length > 1) {
                elements.difficultyBtns[1].click();
            }
        }

        // 初始化游戏
        function initializeGame() {
            initializeProvinces();
            initializeEventListeners();
            updateDateDisplay();
            updateResourcesDisplay();
        }

        // 启动游戏
        window.addEventListener('DOMContentLoaded', initializeGame);
    </script>
</body>
</html>
